---
title: "ST558 Project 1"
author: "Chengxi Zou"
date: '2022-06-25'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE)
```

## Initial Settings

```{r settings, echo=TRUE}
# have a section that notes the required packages needed to run the code to create vignette near the top
library(httr)
library(jsonlite)
library(tidyverse)
library(dplyr)
library(ggplot2)
```

## Reading Data from Pokemon data api

This is a consumption-only API â€” only the HTTP GET method is available on resources.

No authentication is required to access this API, and all resources are fully open and available.

```{r readindata, echo=TRUE}
# the tibble of all berry data
  allberry <- data.frame()
  for (i in 1:64) {
    fullpath = paste(initialpath, i, sep = "")
    a <- GET(fullpath)
    b <- fromJSON(rawToChar(a$content))
    berryinfo <- data.frame(berry.id = b$id,
                            berry.name = b$name,
                            max_harvest = b$max_harvest,
                            growth_time = b$growth_time,
                            power = b$natural_gift_power,
                            size = b$size,
                            smoothness = b$smoothness,
                            soil_dryness = b$soil_dryness,
                            firmness.name = b$firmness$name,
                            flavor.name = b$flavors$flavor$name,
                            item = b$item,
                            natural_gift_power= b$natural_gift_power)
    allberry <- rbind(allberry, berryinfo)
  }
  allberryinfotbl <- as_tibble(allberry)
  allberryinfotbl

initialpath = "https://pokeapi.co/api/v2/berry/"

# search berry data by typing name or id.
# endpoint 1: berries
getberrydata = function(x){
  fullpath = paste(initialpath, x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(berry.id = b$id,
                          berry.name = b$name,
                          max_harvest = b$max_harvest,
                          growth_time = b$growth_time,
                          power = b$natural_gift_power,
                          size = b$size,
                          smoothness = b$smoothness,
                          soil_dryness = b$soil_dryness,
                          firmness.name = b$firmness$name,
                          flavor.name = b$flavors$flavor$name,
                          item = b$item,
                          natural_gift_power= b$natural_gift_power)
berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}

# search berry firmness data by typing name or id.
# endpoint 2: Berry Firmness
getberryfirmdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/berry-firmness/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(firmness.id = b$id,
                          firmness.name = b$name,
                          berry.name = b$berries$name)
  berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}
  
# search berry flavor data by typing name or id.
# endpoint 3: Berry Flavor
getberryflavordata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/berry-flavor/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(flavor.id = b$id,
                          flavor.Name= b$name,
                          berry.name = b$berries$berry$name,
                          potency = b$berries$potency,
                          ct.name = b$contest_type$name)
  berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}


# search Moves
# endpoint 4: Moves
getmovedata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  moveinfo <- data.frame(move.id = b$id,
                         move.name = b$name,
                         ct.name = b$contest_type$name,
                         move.power = b$power,
                         move.pp = b$pp,
                         move.priority = b$priority,
                         move.accuracy = b$accuracy,
                         target.name = b$target$name,
                         damage.class = b$damage_class$name,
                         generation.name = b$generation$name)
  moveinfotbl <- as_tibble(moveinfo)
  return(moveinfotbl)
}

# search Move Ailments
# endpoint 5: Move Ailments
getmadata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move-ailment/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  mainfo <- data.frame(ailment.id = b$id,
                       ailment.name = b$name,
                       move.name = b$moves$name
                       )
  mainfotbl <- as_tibble(mainfo)
  return(mainfotbl)
}

# search Move Categories
# endpoint 6: Move Categories
getmcdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move-category/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  mcinfo <- data.frame(category.id = b$id,
                       category.name = b$name,
                       move.name = b$moves$name,
                       description = b$descriptions$description)
  mcinfotbl <- as_tibble(mcinfo)
  return(mcinfotbl)
}

# search Pokemon
# endpoint 7: Pokemon
getpokemondata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemoninfo <- data.frame(pokemon.id = b$id,
                            pokemon.name = b$name,
                            pokemon.order = b$order,
                            pokemon.height = b$height,
                            pokemon.weight = b$weight,
                            base_experience = b$base_experience,
                            ability.name = b$abilities$ability$name,
                            species.name = b$species$name,
                            pokemon.type = b$types$type$name)
  pokemoninfotbl <- as_tibble(pokemoninfo)
  return(pokemoninfotbl)
}


# search Pokemon Colors
# endpoint 8: Pokemon Colors
getpokemoncolordata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon-color/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemoncolorinfo <- data.frame(pokemon.id = b$id,
                            pokemon.name = b$name,
                            species.name = b$pokemon_species$name)
  pokemoncolorinfotbl <- as_tibble(pokemoncolorinfo)
  return(pokemoncolorinfotbl)
}

# search Pokemon Species
# endpoint 8: Pokemon Species
getpokemonspeciesdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon-species/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemonspeciesinfo <- data.frame(species.id = b$id,
                            species.order = b$order,
                            species.name = bb$name,
                            habitat.name = b$habitat$name,
                            capture.rate = b$capture_rate,
                            base.happiness = b$base_happiness,
                            gender.rate = b$gender_rate,
                            color = b$color$name,
                            shape = b$shape$name,
                            legendary = b$is_legendary)
  pokemonspeciesinfotbl <- as_tibble(pokemonspeciesinfo)
  return(pokemonspeciesinfotbl)
}

getpokemoncolordata(1)
getpokemondata(2)
getpokemonspeciesdata(1)

aa<-GET("https://pokeapi.co/api/v2/pokemon-species/1")
str(aa)
bb <- fromJSON(rawToChar(aa$content))
str(bb)
bbb <- data.frame(bb$id,bb$order,bb$name,bb$habitat$name,bb$capture_rate,bb$base_happiness,bb$gender_rate,bb$color$name,bb$shape$name,bb$is_legendary)
bbb
bbbb <- data.frame(bb$moves$move$name)
bbbb

```

## A basic exploratory data analysis

# Pull data from two endpoints: firmness and flavor. Explore the relationship between them.

```{r, echo=TRUE}
firmdata = data.frame()
for (i in 1:5) {firmdata <- bind_rows(firmdata,getberryfirmdata(i)[,c(2:3)])}
# now the firmdata object contains all firmness info of berries

flavordata = data.frame()
for (i in 1:5) {flavordata <- bind_rows(flavordata,getberryflavordata(i)[,c(1:3)])}
# now the flavordata object contains all flavor info of berries

firmdata
flavordata
```
```{r, echo=TRUE}
# combining them into one data frame in order to do analysis and plot
joindata <- left_join(firmdata,flavordata)
```

# Create a new numeric variable: firmness.level to indicate the level of firmness. (from 1 to 5, larger number indicates harder firmness)

```{r, echo=TRUE}
for (i in 1:144){
if (joindata$firmness.name[i] == "very-soft") {joindata$firmness.level[i] = 1}
if (joindata$firmness.name[i] == "soft") {joindata$firmness.level[i] = 2}
if (joindata$firmness.name[i] == "hard") {joindata$firmness.level[i] = 3}
if (joindata$firmness.name[i] == "very-hard") {joindata$firmness.level[i] = 4}
if (joindata$firmness.name[i] == "super-hard") {joindata$firmness.level[i] = 5}
}

joindata
```

# Create some contingency tables

```{r, echo=TRUE}
table(joindata$berry.name,joindata$flavor.Name,joindata$firmness.name)
```

#  Create numerical summaries for some quantitative variables at each setting of some of your categorical variables

```{r}

```


```{r, echo=TRUE}
ggplot(crabData, aes(x = color)) +
geom_bar(aes(fill = y), position = "dodge") +
xlab("Female Crab Color") +
scale_fill_discrete(name = "")
```


```{r, echo=TRUE}
getberrydata(5)
getberryfirmdata(1)
getberryflavordata(1)


getmadata(1)
getmcdata(1)
getmovedata(1)

getpokemoncolordata(1)
getpokemondata(1)
getpokemonspeciesdata(1)
```

