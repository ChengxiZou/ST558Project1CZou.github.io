---
title: "ST558 Project 1"
author: "Chengxi Zou"
date: '2022-06-25'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE)
```

# Initial Settings

```{r settings, echo=TRUE}
# have a section that notes the required packages needed to run the code to create vignette near the top
library(httr)
library(jsonlite)
library(tidyverse)
library(dplyr)
library(ggplot2)
```

# Reading Data from Pokemon data api

This is a consumption-only API â€” only the HTTP GET method is available on resources.

No authentication is required to access this API, and all resources are fully open and available.

```{r readindata, echo=TRUE}
# the tibble of all berry data
  allberry <- data.frame()
  for (i in 1:64) {
    fullpath = paste(initialpath, i, sep = "")
    a <- GET(fullpath)
    b <- fromJSON(rawToChar(a$content))
    berryinfo <- data.frame(berry.id = b$id,
                            berry.name = b$name,
                            max_harvest = b$max_harvest,
                            growth_time = b$growth_time,
                            power = b$natural_gift_power,
                            size = b$size,
                            smoothness = b$smoothness,
                            soil_dryness = b$soil_dryness,
                            firmness.name = b$firmness$name,
                            flavor.name = b$flavors$flavor$name,
                            item = b$item,
                            natural_gift_power= b$natural_gift_power)
    allberry <- rbind(allberry, berryinfo)
  }
  allberryinfotbl <- as_tibble(allberry)
  allberryinfotbl

initialpath = "https://pokeapi.co/api/v2/berry/"

# search berry data by typing name or id.
# endpoint 1: berries
getberrydata = function(x){
  fullpath = paste(initialpath, x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(berry.id = b$id,
                          berry.name = b$name,
                          max_harvest = b$max_harvest,
                          growth_time = b$growth_time,
                          power = b$natural_gift_power,
                          size = b$size,
                          smoothness = b$smoothness,
                          soil_dryness = b$soil_dryness,
                          firmness.name = b$firmness$name,
                          flavor.name = b$flavors$flavor$name,
                          item = b$item,
                          natural_gift_power= b$natural_gift_power)
berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}

# search berry firmness data by typing name or id.
# endpoint 2: Berry Firmness
getberryfirmdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/berry-firmness/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(firmness.id = b$id,
                          firmness.name = b$name,
                          berry.name = b$berries$name)
  berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}
  
# search berry flavor data by typing name or id.
# endpoint 3: Berry Flavor
getberryflavordata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/berry-flavor/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  berryinfo <- data.frame(flavor.id = b$id,
                          flavor.Name= b$name,
                          berry.name = b$berries$berry$name,
                          potency = b$berries$potency,
                          ct.name = b$contest_type$name)
  berryinfotbl <- as_tibble(berryinfo)
  return(berryinfotbl)
}


# search Moves
# endpoint 4: Moves
getmovedata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  moveinfo <- data.frame(move.id = b$id,
                         move.name = b$name,
                         ct.name = b$contest_type$name,
                         move.power = b$power,
                         move.pp = b$pp,
                         move.priority = b$priority,
                         move.accuracy = b$accuracy,
                         target.name = b$target$name,
                         damage.class = b$damage_class$name,
                         generation.name = b$generation$name)
  moveinfotbl <- as_tibble(moveinfo)
  return(moveinfotbl)
}

# search Move Ailments
# endpoint 5: Move Ailments
getmadata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move-ailment/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  mainfo <- data.frame(ailment.id = b$id,
                       ailment.name = b$name,
                       move.name = b$moves$name
                       )
  mainfotbl <- as_tibble(mainfo)
  return(mainfotbl)
}

# search Move Categories
# endpoint 6: Move Categories
getmcdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/move-category/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  mcinfo <- data.frame(category.id = b$id,
                       category.name = b$name,
                       move.name = b$moves$name,
                       description = b$descriptions$description)
  mcinfotbl <- as_tibble(mcinfo)
  return(mcinfotbl)
}

# search Pokemon
# endpoint 7: Pokemon
getpokemondata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemoninfo <- data.frame(pokemon.id = b$id,
                            pokemon.name = b$name,
                            pokemon.height = b$height,
                            pokemon.weight = b$weight,
                            base_experience = b$base_experience,
                            species.name = b$species$name,
                            pokemon.type = b$types$type$name)
  pokemoninfotbl <- as_tibble(pokemoninfo)
  return(pokemoninfotbl)
}


# search Pokemon Colors
# endpoint 8: Pokemon Colors
getpokemoncolordata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon-color/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemoncolorinfo <- data.frame(color.id = b$id,
                            color.name = b$name,
                            species.name = b$pokemon_species$name)
  pokemoncolorinfotbl <- as_tibble(pokemoncolorinfo)
  return(pokemoncolorinfotbl)
}

# search Pokemon Species
# endpoint 8: Pokemon Species
getpokemonspeciesdata = function(x){
  fullpath = paste("https://pokeapi.co/api/v2/pokemon-species/", x, sep = "")
  a <- GET(fullpath)
  b <- fromJSON(rawToChar(a$content))
  pokemonspeciesinfo <- data.frame(species.id = b$id,
                            species.order = b$order,
                            species.name = bb$name,
                            habitat.name = b$habitat$name,
                            capture.rate = b$capture_rate,
                            base.happiness = b$base_happiness,
                            gender.rate = b$gender_rate,
                            color = b$color$name,
                            shape = b$shape$name,
                            legendary = b$is_legendary)
  pokemonspeciesinfotbl <- as_tibble(pokemonspeciesinfo)
  return(pokemonspeciesinfotbl)
}
```

# A basic exploratory data analysis

## Pull data from two endpoints: pokemoncolor and getpokemon. Explore the relationship between color, weight, length.

```{r, echo=TRUE}
colordata = data.frame()
for (i in 1:10) {colordata <- bind_rows(colordata,getpokemoncolordata(i)[,c(2:3)])}
# now the firmdata object contains all firmness info of berries

hwdata = data.frame()
for (i in 1:898) {hwdata <- bind_rows(hwdata,getpokemondata(i)[,c(1:4,6)])}
# now the flavordata object contains all flavor info of berries

colordata
head(hwdata)
```

Notice that some species have multiplr types so they were counted multiple times. That make sense.

Combining those two data frame into one in order to do analysis and plot:

```{r, echo=TRUE}
joindata <- left_join(colordata,hwdata)
joindata
```

## Create a new numeric variable: BMI = weight/(height ^ 2)

```{r, echo=TRUE}
joindata$BMI = joindata$pokemon.weight/(joindata$pokemon.height * joindata$pokemon.height)
joindata
```

Create other new variables: BMI.level, height.level, weight.level.

```{r, echo=TRUE}
help("drop_na")
joindata2 <- drop_na(joindata,c("BMI","pokemon.weight","pokemon.height","pokemon.name","pokemon.id","species.name","color.name"))
for (i in 1:1340) {
  if (joindata2$BMI[i] > 10) {joindata2$BMI.level[i] = "strong"}
  if (joindata2$BMI[i] <= 10) {joindata2$BMI.level[i] = "thin"}
  if (joindata2$pokemon.height[i] > 30) {joindata2$height.level[i] = "tall"}
  if (joindata2$pokemon.height[i] <= 30) {joindata2$height.level[i] = "short"}
  if (joindata2$pokemon.weight[i] > 2000) {joindata2$weight.level[i] = "heavy"}
  if (joindata2$pokemon.weight[i] <= 2000) {joindata2$weight.level[i] = "light"}
}

joindata2
```

## Create some contingency tables

Create a contingency table showing the count of color and BMI level.

```{r, echo=TRUE}
table(joindata2$color.name,joindata2$BMI.level)
```

Create a contingency table showing the count of height and BMI level.

```{r, echo=TRUE}
table(joindata2$height.level,joindata2$BMI.level)
```

Create a contingency table showing the count of weight and BMI level.

```{r, echo=TRUE}
table(joindata2$weight.level,joindata2$BMI.level)
```

Create a contingency table showing the count of height and weight.

```{r, echo=TRUE}
table(joindata2$height.level,joindata2$weight.level)
```

##  Create numerical summaries for some quantitative variables at each setting of some of your categorical variables

Summary of the joined data object.

```{r}
summary(joindata2)
```

Let's see how BMI behaves at each settings of color.

```{r}
joindata2 %>% group_by(color.name) %>% summarise(Min = min(BMI), Median = median(BMI),
                                                 Mean = mean(BMI), Max = max(BMI), IQR = IQR(BMI))
```

Let's see how BMI behaves at each settings of BMI level.

```{r}
joindata2 %>% group_by(BMI.level) %>% summarise(Min = min(BMI), Median = median(BMI),
                                                 Mean = mean(BMI), Max = max(BMI), IQR = IQR(BMI))
```

Let's see how BMI behaves at each settings of height level.

```{r}
joindata2 %>% group_by(height.level) %>% summarise(Min = min(BMI), Median = median(BMI),
                                                 Mean = mean(BMI), Max = max(BMI), IQR = IQR(BMI))
```

Let's see how BMI behaves at each settings of weight level.

```{r}
joindata2 %>% group_by(weight.level) %>% summarise(Min = min(BMI), Median = median(BMI),
                                                 Mean = mean(BMI), Max = max(BMI), IQR = IQR(BMI))
```

Let's see how height behaves at each settings of BMI level.

```{r}
joindata2 %>% group_by(BMI.level) %>% summarise(Min = min(pokemon.height), Median = median(pokemon.height),
                                                 Mean = mean(pokemon.height), Max = max(pokemon.height), IQR = IQR(pokemon.height))
```

Let's see how weight behaves at each settings of BMI level.

```{r}
joindata2 %>% group_by(BMI.level) %>% summarise(Min = min(pokemon.weight), Median = median(pokemon.weight),
                                                 Mean = mean(pokemon.weight), Max = max(pokemon.height), IQR = IQR(pokemon.weight))
```

## Create plots.

```{r, echo=TRUE}
ggplot(crabData, aes(x = color)) +
geom_bar(aes(fill = y), position = "dodge") +
xlab("Female Crab Color") +
scale_fill_discrete(name = "")
```


```{r, echo=TRUE}
getberrydata(5)
getberryfirmdata(1)
getberryflavordata(1)


getmadata(1)
getmcdata(1)
getmovedata(1)

getpokemoncolordata(1)
getpokemondata(1)
getpokemonspeciesdata(1)
```

